#! /bin/sh

PREFIX=@prefix@
LIBEXECDIR=@libexecdir@
DATADIR=@datadir@/maynard
DEFAULT_BACKGROUND=/usr/share/weston/background.png

nested=
display_server=

usage()
{
  echo "usage: $0 [OPTION...]"
  echo
  echo "    -n, --nested              Run as nested compositor"
  echo "    -d, --display-server      Run as a full display server, rather than nested (default)"
  echo "    -h, --help                Display this help and exit"
}

while [ "$1" != "" ]; do
    case $1 in
        -d | --display-server ) display_server=true
                                ;;
        -n | --nested )         nested=true
                                ;;
        -h | --help )           usage
                                exit
                                ;;
        * )                     usage
                                exit
                                ;;
    esac
    shift
done

if [ "x$display_server" = "xtrue" -a "x$nested" = "xtrue" ]; then
   echo "Can't run both as nested and as a display server"
   exit
fi

mkdir ~/.config > /dev/null 2>&1

if [ -z "${MAYNARD_BACKGROUND+_}" -a \
     -e "$DEFAULT_BACKGROUND" ]; then
    export MAYNARD_BACKGROUND="$DEFAULT_BACKGROUND"
fi

echo "display server: $display_server"
echo "nested: $nested"

if [ "x$display_server" = "xtrue" ]; then
    weston-launch -- --config $DATADIR/maynard.ini
else
    # default as nested
    weston --config $DATADIR/maynard.ini
fi
